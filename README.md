# CoCo Assembler

[![Build Status](https://img.shields.io/travis/craigthomas/CoCoAssembler?style=flat-square)](https://travis-ci.org/craigthomas/CoCoAssembler) 
[![Codecov](https://img.shields.io/codecov/c/gh/craigthomas/CoCoAssembler?style=flat-square)](https://codecov.io/gh/craigthomas/CoCoAssembler) 
[![Dependencies](https://img.shields.io/librariesio/github/craigthomas/CoCoAssembler?style=flat-square)](https://libraries.io/github/craigthomas/CoCoAssembler)
[![License: MIT](https://img.shields.io/badge/license-MIT-blue.svg?style=flat-square)](https://opensource.org/licenses/MIT)

## Table of Contents

1. [What is it?](#what-is-it)
2. [Requirements](#requirements)
3. [License](#license)
4. [Installing](#installing)
5. [Usage](#usage)

## What is it?

This project is an assembler for the Tandy Color Computer 1, 2 and 3 written in Python 3.6. 
It is intended to be statement compatible with any code written for the EDTASM+ assembler.

## Requirements

In order to run the assembler, you will need Python 3.6 or greater. If you
prefer to clone the repository, you will need Git (if you don't want to 
install Git, then check the [Releases](https://github.com/craigthomas/CoCoAssembler/releases)
section for the newest release of the package that you can download.

## License

This project makes use of an MIT style license. Please see the file called 
LICENSE for more information.

## Installing

To install the source files, download the latest release from the 
[Releases](https://github.com/craigthomas/CoCoAssembler/releases) 
section of the repository and unzip the contents in a directory of your 
choice. Or, clone the repository in the directory of your choice with:

    git clone https://github.com/craigthomas/CoCoAssembler.git

Next, you will need to install the required packages for the file:

    pip install -r requirements.txt

    
## Usage

To run the assembler:

    python assembler.py input_file --output output_file

This will assemble the instructions found in file `input_file` and will generate
the associated Color Computer machine instructions in binary format in `output_file`.

### Input Format

The input file needs to follow the format below:

    LABEL    MNEMONIC    OPERANDS    COMMENT

Where:

* `LABEL` is a 10 character label for the statement
* `MNEMONIC` is a 6809 operation mnemonic from the [Mnemonic Table](#mnemonic-table) below
* `OPERANDS` are registers, values, expressions, or labels as described in the [Operands](#operands) section
* `COMMENT` is a 40 character comment describing the statement (must have a `;` preceding it)

An example file:

    # A comment line that contains nothing


### Print Symbol Table

To print the symbol table that is generated during assembly, use the `--symbols` 
switch:

    python assembler.py test.asm --symbols

Which will have the following output:

    -- Symbol Table --


### Print Assembled Statements

To print out the assembled version of the program, use the `--print` switch:

    python assembler.py test.asm --print

Which will have the following output:

    -- Assembled Statements --

With this output, the first column is the offset in hex where the statement starts,
the second column contains a truncated version of the machine code generated by the
statement (truncated to 10 hex characters), the third column is the user-supplied 
label for the statement, the forth column is the mnemonic, the fifth
column is the register values of other numeric or label data the operation will
work on, and the fifth column is the comment string.

## Mnemonic Table

Below are the mnemonics that are accepted by the assembler (these mnemonics are 
compatible with EDTASM+ assembler mnemonics).
 
### Mnemonics

| Mnemonic | Description | Example |
| -------- | ----------- | ------- |
| `ABX`    | Adds accumulator `B` to value in register `X` and stores in `X`.           | `ABX`                  |
| `ADCA`   | Adds accumulator `A`, memory value `M`, and carry bit and stores in `A`.   | `ADCA $FFEE`           |
| `ADCB`   | Adds accumulator `B`, memory value `M`, and carry bit and stores in `B`.   | `ADCB $FFEF`           |
| `ADDA`   | Adds accumulator `A` with memory value `M` and stores in `A`.              | `ADDA #$03`            |
| `ADDB`   | Adds accumulator `B` with memory value `M` and stores in `B`.              | `ADDB #$90`            |
| `ADDD`   | Adds accumulator `D` (`A:B`) with memory value `M:M+1` and stores in `D`.  | `ADDD #$2000`          |

### Pseudo Operations

| Mnemonic | Description | Example |
| -------- | ----------- | ------- |
| `FCB`    | Defines a single byte constant value.                                      | `FCB $1C`              |
| `FCC`    | Defines a string constant value enclosed in a matching pair of delimiters. | `FCC "hello"`          |
| `FDB`    | Defines a two byte constant value.                                         | `FDB $2000`            |
| `END`    | Defines the end of the program.                                            | `END`                  |
| `EQU`    | Defines a symbol with a set value.                                         | `SCRMEM EQU $1000`     |
| `INCLUDE`| Includes another assembly source file at this location.                    | `INCLUDE globals.asm`  |
| `ORG`    | Defines where in memory the program should originate at.                   | `ORG $0E00`            |
| `SETDP`  | Sets the direct page value for the assembler (see notes below).            | `SETDP $0E00`          |

**Notes**

* `SETDP` - this mnemonic is used for memory and instruction optimization by the assembler. For example, 
if `SETDP $0E00` is set, any machine instructions that use `$0EXX` as a memory location will be assembled 
using direct page addressing. Instructions such as `JMP $0E8F` will become `JMP <$8F`. The programmer is 
responsible for loading the direct page register manually - this mnemonic does not output opcodes that
change the direct page register. 

### Operands

### Addressing Modes

## Further Documentation

The best documentation is in the code itself. Please feel free to examine the
code and experiment with it.
